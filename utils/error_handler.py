"""
–£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
"""
from typing import Optional

# –î–µ–π—Å—Ç–≤–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ—à–∏–±–æ–∫
ACTION_NAMES = {
    "mute": "–º—É—Ç–∞",
    "unmute": "—Å–Ω—è—Ç–∏—è –º—É—Ç–∞",
    "ban": "–±–∞–Ω–∞",
    "unban": "—Ä–∞–∑–±–∞–Ω–∞",
    "kick": "–∏—Å–∫–ª—é—á–µ–Ω–∏—è",
    "warn": "–≤—ã–¥–∞—á–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è",
    "unwarn": "—Å–Ω—è—Ç–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è",
    "ap": "–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–Ω–≥–∞",
    "unap": "—Å–Ω—è—Ç–∏—è —Ä–∞–Ω–≥–∞",
    "–ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π": "–ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π",
    "–ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤": "–ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤",
    "–º—É—Ç–∞": "–º—É—Ç–∞",
    "—Å–Ω—è—Ç–∏—è –º—É—Ç–∞": "—Å–Ω—è—Ç–∏—è –º—É—Ç–∞",
    "–±–∞–Ω–∞": "–±–∞–Ω–∞",
    "—Ä–∞–∑–±–∞–Ω–∞": "—Ä–∞–∑–±–∞–Ω–∞",
    "–∏—Å–∫–ª—é—á–µ–Ω–∏—è": "–∏—Å–∫–ª—é—á–µ–Ω–∏—è",
}


def get_error_message(exception: Exception, action: str = "–¥–µ–π—Å—Ç–≤–∏—è") -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ —Å —ç–º–æ–¥–∑–∏
    
    Args:
        exception: –ò—Å–∫–ª—é—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ
        action: –ù–∞–∑–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (mute, ban, kick –∏ —Ç.–¥.) –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    
    Returns:
        –°—Ç—Ä–æ–∫–∞ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ —Å —ç–º–æ–¥–∑–∏
    """
    error_str = str(exception).lower()
    error_type = type(exception).__name__
    
    # –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è
    action_name = ACTION_NAMES.get(action, action)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –∏—Å–∫–ª—é—á–µ–Ω–∏—è (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è aiogram)
    try:
        from aiogram.exceptions import (
            TelegramForbiddenError, TelegramBadRequest, 
            TelegramNotFound, TelegramUnauthorizedError
        )
        
        if isinstance(exception, TelegramForbiddenError):
            # –û—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞ - –±–æ—Ç –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤
            if "not enough rights" in error_str or "can't restrict" in error_str or "can't ban" in error_str:
                if "restrict" in error_str or "mute" in action.lower():
                    return f"üîí –£ –º–µ–Ω—è –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–∞–≤ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è {action_name}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —è —è–≤–ª—è—é—Å—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∏ –∏–º–µ—é –ø—Ä–∞–≤–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤."
                elif "ban" in error_str or "ban" in action.lower():
                    return f"üîí –£ –º–µ–Ω—è –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–∞–≤ –¥–ª—è {action_name}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞."
                else:
                    return f"üîí –£ –º–µ–Ω—è –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–∞–≤ –¥–ª—è {action_name}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞."
            elif "bot is not a member" in error_str or "bot is not an administrator" in error_str:
                return "üîí –Ø –Ω–µ —è–≤–ª—è—é—Å—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —ç—Ç–æ–≥–æ —á–∞—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –º–µ–Ω—è –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã."
            else:
                return f"üîí –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –£ –º–µ–Ω—è –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è {action_name}."
        
        if isinstance(exception, TelegramBadRequest):
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ü–ï–†–ï–î –æ–±—â–∏–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ bad request
            if "not enough rights" in error_str or "can't restrict" in error_str or "can't ban" in error_str:
                if "restrict" in error_str or "mute" in action.lower():
                    return f"üîí –£ –º–µ–Ω—è –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–∞–≤ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è {action_name}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —è —è–≤–ª—è—é—Å—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∏ –∏–º–µ—é –ø—Ä–∞–≤–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤."
                elif "ban" in error_str or "ban" in action.lower():
                    return f"üîí –£ –º–µ–Ω—è –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–∞–≤ –¥–ª—è {action_name}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞."
                else:
                    return f"üîí –£ –º–µ–Ω—è –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–∞–≤ –¥–ª—è {action_name}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞."
            elif "user not found" in error_str:
                return "üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–∞–ø–∏—Å–∞–ª –≤ —á–∞—Ç–µ."
            elif "chat not found" in error_str:
                return "üí¨ –ß–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω."
            elif "user is an administrator" in error_str or ("can't restrict" in error_str and "admin" in error_str):
                return "üõ°Ô∏è –ù–µ –º–æ–≥—É –∑–∞–º—É—Ç–∏—Ç—å/–∑–∞–±–∞–Ω–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —á–∞—Ç–∞."
            elif "can't restrict chat owner" in error_str or ("chat owner" in error_str and "restrict" in error_str):
                return "üëë –ù–µ –º–æ–≥—É –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ —á–∞—Ç–∞."
            else:
                return f"‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å: {str(exception)}"
        
        if isinstance(exception, TelegramNotFound):
            if "user" in error_str:
                return "üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–∞–ø–∏—Å–∞–ª –≤ —á–∞—Ç–µ."
            elif "chat" in error_str:
                return "üí¨ –ß–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω."
        
        if isinstance(exception, TelegramUnauthorizedError):
            return "üîê –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞."
            
    except ImportError:
        # –ï—Å–ª–∏ aiogram –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –ø–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫—É –æ—à–∏–±–∫–∏
        pass
    
    # –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫—É –æ—à–∏–±–∫–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞
    if "not enough rights" in error_str or "can't restrict" in error_str or "can't ban" in error_str:
        if "restrict" in error_str or "mute" in action.lower():
            return f"üîí –£ –º–µ–Ω—è –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–∞–≤ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è {action_name}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —è —è–≤–ª—è—é—Å—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∏ –∏–º–µ—é –ø—Ä–∞–≤–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤."
        elif "ban" in error_str or "ban" in action.lower():
            return f"üîí –£ –º–µ–Ω—è –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–∞–≤ –¥–ª—è {action_name}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞."
        else:
            return f"üîí –£ –º–µ–Ω—è –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–∞–≤ –¥–ª—è {action_name}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞."
    
    if "bot is not a member" in error_str or "bot is not an administrator" in error_str:
        return "üîí –Ø –Ω–µ —è–≤–ª—è—é—Å—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —ç—Ç–æ–≥–æ —á–∞—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –º–µ–Ω—è –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã."
    
    if "user not found" in error_str:
        return "üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–∞–ø–∏—Å–∞–ª –≤ —á–∞—Ç–µ."
    
    if "chat not found" in error_str:
        return "üí¨ –ß–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω."
    
    if "user is an administrator" in error_str or ("can't restrict" in error_str and "admin" in error_str):
        return "üõ°Ô∏è –ù–µ –º–æ–≥—É –∑–∞–º—É—Ç–∏—Ç—å/–∑–∞–±–∞–Ω–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —á–∞—Ç–∞."
    
    if "can't restrict chat owner" in error_str or ("chat owner" in error_str and "restrict" in error_str):
        return "üëë –ù–µ –º–æ–≥—É –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ —á–∞—Ç–∞."
    
    if "timeout" in error_str or "network" in error_str or "connection" in error_str:
        return "üí• –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º Telegram. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
    
    if "bad request" in error_str:
        return f"‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å: {str(exception)}"
    
    # –û–±—â–∞—è –æ—à–∏–±–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    return f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ {action_name}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."

